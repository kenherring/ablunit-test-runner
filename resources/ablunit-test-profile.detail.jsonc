/********* Test Run Configuration for the ABLUnit Test Runner Extension *********/

////#
////# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
////# !!!!! This file and the configuration values are not required !!!!!
////# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
////#
////# Keys which are not provided in this file will use the defaults as referenced below.
////#
////#  * Blank values are the same as not providing the key.
////#  * All paths are assumed as absolute, or relative to the workspace.
////#
////# The following substituion can be used in path values:
////#   * ${DLC} - The OpenEdge installation directory, determined in the following order:
////#       * From the `opendge-project.json` file configuration
////#       * From the `DLC` environment variable
////#   * ${tempDir} - See the "tempDir" key below
////#   * ${workspaceFolder} - The path of the folder opened in VS Code

{
	"configurations": [{

		////# Path to directory where temporary files will be written.  This path will be
		////# added to the command line with the temporary directory (-T) option.
		////# Files generated by this extension and OpenEdge progress will also be written here.
		"tempDir": "${workspaceFolder}",

		////# When true read 'openedge-project.json' to determine proper configuration
		////# including DLC, propath, and database connections.  Additionally, a specific
		////$ profile can be referenced for use by the test run.
		"importOpenedgeProjectJson": true,
		"openedgeProjectProfile": "default",

		////# Timeout in milliseconds for the ablunit command to complete.  Set to 0 for no timeout.p
		"timeout": 30000,

		////# Configuration object related to the command line run to execute tests.
		"command": {

			////# Path to the executable used launch the test run.
			"executable": "_progres",

			////# Path to the "progressIni" file which can define a propath, etc.  It will be
			////# passed to the test run process with the following parameters:
			////#    '-basekey INI -ininame ${progressIni}'
			////#
			////# Notes:
			////#   * When the value provided resolves to an existing file it will be copied
			////#     to the "tempDir" before test execution.
			////#   * If no value is provided or the file does not exist the extension will
			////#     attempt to create a default progress.ini file in the "tempDir".
			////#   * A blank value will remove the related args from the command line.
			"progressIni": "progress.ini",

			////# Include batch mode (-b) argument
			"batch": true,

			////# These parameters will be passed to the command line.  Most commonly
			////# this would be used to provide database connection parameters.
			////# "additionalArgs": [
			////#    "-pf",
			////# 	 "path/to/dbconnections.pf"
			////# ],
			"additionalArgs": []
		},

		////# The "config" key contains values that will be added to 'ablunit.json'.
		////# See the OpenEdge documentation for more information about these values.
		////#   * https://docs.progress.com/bundle/openedge-developer-studio-help/page/Run-test-cases-from-the-command-prompt.html
		////#
		////# NOTE: 'ablunit.json will not be created when "options": null
		"options": {
			"output": {
				"location": "${tempDir}",
				"filename": "results",
				"format": "xml",
				"writeJson": true,
				"updateFile": "updates.log" // custom for the ablunit-test-runner extension
			},
			"debug": false,
			"quitOnEnd": true,
			"writeLog":  false,
			"showErrorMessage": true,
			"throwError": true,

			////# The "xref" key contains values to enable the use of existing xref files
			////# in the xml format that have been pre-generated by a build process.
			"xref": {
				"useXref": true,
				"xrefLocation": "${tempDir}",
				"xrefExtension": "xref",
				"xrefThrowError": false
			}
		},

		////# By default this extension enable the PROFILER when running tests.  The output
		////# is parsed to calculate and render code coverage.  The keys in this section can be
		////# modified to further change the behavior of the PROFILER during test execution.
		////#
		////# These options are added to a 'profiler.options' file and passed as command line args:
		////#   `-profile ${tempDir}/profiler.options`
		////#
		////# NOTES:
		////#   * When the "enabled" flag is false the process will not have the profiler enabled
		////#     on startup but the `-profile` option is passed to the command., args will not be passed to
		////#     the command line, and the "profiler.options" file will not be created.
		////#   * When the "profiler" key is set to null the 'profile.options' file will not
		////#     be created and the `-profile` option will not be passed to the command line.
		////#   * When "enabled" is false, the profiler information is not collection and coverage cannot
		////#     be reported.  This is not recommended.  The option is included here for completeness.
		////#
		////# See the OpenEdge documentation for more information about these values.
		////#   * https://docs.progress.com/bundle/openedge-startup-and-parameter-reference/page/Profiler-profile.html
		////#   * https://docs.progress.com/bundle/abl-reference/page/PROFILER-system-handle.html
		"profiler": {
			"enabled": true,
			"coverage": true,
			"description": "Run via VSCode - ABLUnit Test Runner Extension",
			"filename": "prof.out",
			"listings": false,
			"statistics": false,
			"traceFilter": "",
			"tracing": "",
			"writeJson": false,
			"perTest": true, // capture profiler data separately for each test case
			"ignoreExternalCoverage": true // do not calculate coverage for external code (outside of workspace)
		}

	}]
}
